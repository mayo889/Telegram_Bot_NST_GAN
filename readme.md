## Телеграм бот
### Aiogram StyleTransfer CycleGAN Webhook Heroku

## Telegram Bot
Для написания бота использовалась библиотека Aiogram


## StyleTransfer
Для переноса стилей были выполнены следующие действия:
1. Взята обученная модель VGG16
2. Чтобы выполнить требования к домашнему заданию модель была дополнительно доучена на датасете Caltech 101, содержащим 101 категорию данных и 8677 картинок
3. Чтобы сэкономить память, были сохранены веса только нужных слоев (первые 11)
4. Для переноса стилей использован классический алгоритм, который подразумевает итеративное изменение входной картинки на основе разницы с style и content картинками
5. При формировании модели для Style Transfer не используются слои модели VGG16 напрямую, объявляются только необходимые 11 слоев через nn.Sequential с целью сэкономить память при дальнейшем использовании Heroku


## CycleGAN
Для использования CycleGAN был взят код junyanz [pytorch-CycleGAN-and-pix2pix](https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix)
Исходный код дает возможность использовать множество моделей и датасетов.

Для использования такого большого проекта в собственных нуждах были выполнены следующие действия:
1. Взята архитектура только CycleGAN (папка _models_)
    * Убраны лишние функции
    * Переделан вход модели, чтобы она принимала не датасет, а сразу картинки
    * Модель сразу отдает результат генерации, а не пускает его дальше по пайплайну
2. Взяты опции для запуски скрипта в тестовом режиме (папка _options_)
3. Полностью убрано использование датасетов и любые функции связанные с ними.
4. В папке _scripts_ находится единственный скрипт для загрузки весов натренированного CycleGAN. Для загрузки необходимо перейти в папку с CycleGAN и запустить скрипт с выбранными весами. Я использовал summer2winter_yosemite и winter2summer_yosemite. Веса загружаются в папку _checkpoints_
```
$ cd model_cyclegan
$ bash ./scripts/download_cyclegan_model.sh summer2winter_yosemite
```
5. Был переделан скрипт test.py, чтобы создать модель со стандартными параметрами и сохранить ее полностью в файлы pth для дальнейшего использования ботом. Сделано это для того, чтобы отпала необходимость сложного создания модели при работе бота. Модели сохраняются в папку _models_wts_. Скрипт test.py запускается следующим образом:
```
$ cd model_cyclegan
$ python test.py --name summer2winter_yosemite_pretrained --model test --no_dropout --gpu_ids -1
```
gpu_ids равняется -1, так как подразумевается использование модели только на CPU



## Структура репозитория
| | | Описание файлов и папок |
| --- | --- | --- |
| images | | |
|  | examples | Примеры работы модели |
|  | styles | Варианты картинок для стиля |
| model_cyclegan | | |
|  | checkpoints | Веса, используемые для создания СycleGAN |
|  | models | Архитектура СycleGAN |
|  | options | Параметры для создания СycleGAN |
|  | scripts | Внутри скрипт для загрузки весов CycleGAN |
|  | CycleGAN.py | Пайплайн для СycleGAN |
|  | test.py | Скрипт для создания моделей с загруженными весами|
| model_nst | | |
|  | StyleTransfer.py | Модель и пайплайн для StyleTransfer |
| models_wts | | Веса для всех моделей |
| bot.py | | Код телеграм бота |
| keyboards.py | | Клавиатуры и сообщения для бота |
| image_processing.py | | Запуск пайплайнов для NST и CycleGAN |
| requirements.txt | | Необходимые пакеты |
| Procfile | | Команда при запуске Heroku |
| __init__.py | | Пустой файл для работы Heroku |
